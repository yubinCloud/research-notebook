import{_ as c,r as n,o as r,c as o,a as s,b as e,d as a,w as l,e as m}from"./app-s5JIphqh.js";const p={},h={href:"http://arxiv.org/abs/2406.12692",target:"_blank",rel:"noopener noreferrer"},g=s("p",null,"⭐⭐⭐⭐",-1),d=s("p",null,"莱顿大学 & Microsoft, arXiv:2406.12692",-1),u=s("h2",{id:"一、论文速读",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#一、论文速读"},[s("span",null,"一、论文速读")])],-1),_=s("p",null,"DIN-SQL 模型中使用了一个 self-correction 模块，他把 LLM 直接生成的 SQL 带上一些 guidelines 的 prompt，让 LLM 进行自我检查并改正这个错误的 SQL。但是这里的 guidelines 是人工手写的，比如下图是 DIN-SQL 中的 self-correction guidelines 的 prompt：",-1),k=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/1717161441480.png",alt:"1717161441480",style:{zoom:"75%"}},null,-1),x=s("p",null,[e("这篇论文提出了一个可以自动生成 self-correction guidelines 的方法："),s("mark",null,"MAGIC"),e("。")],-1),f=s("p",null,[s("strong",null,"任务定义"),e("：给定 user question、DB schema 和一个错误的 SQL，生成一个 self-correction guidelines，可以 prompt LLM 来纠正错误的 SQL 从而得到纠正正确的 SQL。这个任务就是本论文需要解决的任务——"),s("mark",null,"self-correction guideline generation"),e(" 任务。")],-1),b=s("blockquote",null,[s("p",null,"输入中的错误的 SQL 就是原先由 LLM 生成的 SQL 但不能正确执行的 SQL。")],-1),L=s("p",null,"下图就是 LLM 使用 self-correction guidelines 来纠正错误 SQL 的示例：",-1),y=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240625205622.png",alt:"20240625205622",style:{zoom:"75%"}},null,-1),v=s("p",null,"可以看到，LLM 可以根据 guidelines 来检查这个错误 SQL，找出其中的问题从而得到修正后的正确 SQL。",-1),w=s("h2",{id:"二、magic",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#二、magic"},[s("span",null,"二、MAGIC")])],-1),M=s("p",null,[e("假设使用 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"s'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7519em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),e(" 表示 incorrect SQL，使用 "),s("code",null,"s^{gt}"),e(" 表示 ground-truth SQL。")],-1),S=s("p",null,"MAGIC 由 3 个 agent 组成：manager agent、feedback agent 和 correction agent。",-1),Q=s("h3",{id:"_2-1-feedback-correction-cycle",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-1-feedback-correction-cycle"},[s("span",null,"2.1 Feedback-correction cycle")])],-1),z=s("p",null,[e("给定一个 user question、"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mrow",null,[s("mi",null,"g"),s("mi",null,"t")])])]),s("annotation",{encoding:"application/x-tex"},"s^{gt}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7936em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7936em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"g"),s("span",{class:"mord mathnormal mtight"},"t")])])])])])])])])])])]),e("、"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"s'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7519em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),e("，那 manager agent 就开始一个 feedback-correction cycle，它是一个迭代的过程。")],-1),I=s("p",null,"在每一个 iteration 中：",-1),C=s("ul",null,[s("li",null,[e("manager agent 要求 feedback agent 通过对比 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"s'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7519em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),e(" 和 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mrow",null,[s("mi",null,"g"),s("mi",null,"t")])])]),s("annotation",{encoding:"application/x-tex"},"s^{gt}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7936em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7936em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.03588em"}},"g"),s("span",{class:"mord mathnormal mtight"},"t")])])])])])])])])])])]),e(" 来生成一个 "),s("strong",null,"feedback"),e(" 来解释 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"s'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7519em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),e(" 中的错误")]),s("li",null,[e("之后，manager agent 将接收到的 feedback 给 correction agent，要求它根据 feedback 修正 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"s'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7519em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),e(" 从而生成一个新的 "),s("strong",null,"revised SQL")])],-1),T=s("p",null,"重复进行迭代，直到 revised SQL 正确或者迭代次数达到最大限制。",-1),G=s("h3",{id:"_2-2-revising-agents-instruction",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-2-revising-agents-instruction"},[s("span",null,"2.2 Revising agents' instruction")])],-1),N=s("p",null,"刚刚 feedback-correction cycle 是说了 manager agent 交互的流程来不断修正 SQL。",-1),A=s("p",null,"这里是在说 manager agent 在于另外两个 agent 交互时，所使用的 prompt 也是在不断被修正的。",-1),q=s("p",null,[e("在 feedback-correction cycle 的第一个 iteration 中，manager agent 使用了两个 predefined prompts 来与 feedback-agent 和 correction-agent 做的交互。但是如果一次 iteration 后 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"s"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"s'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.7519em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"s"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),e(" 仍然没有被修正正确，那么 manager agent 也要修正这些 predefined prompts。")],-1),B=s("p",null,"那 manager agent 怎么修正 prompts 呢？—— 使用一个专门设计的 prompt 来提示 LLM 来修正 predefined prompts。",-1),E=s("h3",{id:"_2-3-guideline-generation",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-3-guideline-generation"},[s("span",null,"2.3 Guideline generation")])],-1),D=s("p",null,"当 correction agent 每次修正成功一个 SQL 后，manager agent 会记下来这一轮 iteration 中由 feedback agent 生成的 feedback。",-1),P=s("blockquote",null,[s("p",null,"因为是这一个 feedback 来让 correction agent 修正正确的，所以这一个 feedback 是指出了 SQL 错误的关键，因此让 manager agent 记下来。")],-1),V=s("p",null,[e("每个 data point 会在经过一个 feedback-correction cycle 后记录一个 feedback 到 memory 中，当 manager agent 记录的 feedbacks 累计达到 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"k")]),s("annotation",{encoding:"application/x-tex"},"k")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.6944em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03148em"}},"k")])])]),e(" 个之后，会将这一 batch 的 k 个 feedbacks 一同形成一个 self-correction guideline。")],-1),R=m('<p>这个 self-correction guideline 会被用于之后的 Text2SQL 的 self-correction 过程中，直到又累积到 k 个 feedbacks 后重新触发生成一个 self-correction guideline。</p><p>利用 k 个 feedbacks 来生成 guideline 的方法，就是使用一个专门的 prompt 来提示 LLM 生成。</p><p>在第一个 batch 中，还没有可用的 guideline，这时 manager agent 会先初始化一个 guideline，之后的每个 batch，manager agent 会更新现在的 guideline。</p><h2 id="三、所有用到的-prompts" tabindex="-1"><a class="header-anchor" href="#三、所有用到的-prompts"><span>三、所有用到的 prompts</span></a></h2><p>这里总结一下整个方法所使用的 prompts：</p><ul><li>两个 predefined prompts：这两个 prompts 用来一开始时 manager agent 用来与 feedback agent 和 correction agent 进行交互。</li><li>manager agent 用来修正 predefined prompts 的两个 prompts：一个 prompt 用来让 manager agent 修正与 feedback agent 交互所用的 prompt，一个是修正与 correction agent 的。</li><li>manager agent 用来将 k 个 feedbacks 生成出一个 self-correction guideline 的 prompt。</li></ul><h2 id="四、实验" tabindex="-1"><a class="header-anchor" href="#四、实验"><span>四、实验</span></a></h2><p>以往的 DIN-SQL 中就有一个 self-correction module，这个模块使用一个 guideline 来让 LLM 修正错误的 SQL，但这个模型中的 guideline 是人工设计的。这篇论文尝试将这个模块的 guideline 更换为使用本文提出的自动生成的 guideline，发现整个 Text2SQL 模型的表现得到了很大的提升，从而证明了方法的有效性。</p><h2 id="五、总结" tabindex="-1"><a class="header-anchor" href="#五、总结"><span>五、总结</span></a></h2><p>这篇论文着重指出了 in-context learning 的 Text2SQL 任务中 self-correction 的新颖视角，将提升 Text2SQL 中的 self-correction 作为一个单独的任务，克服了以往方法需要手工设计 self-correction guideline 的缺点。</p><p>同时，这篇论文还解决了自动修复人类生成的错误 SQL 的重要任务，展示了 LLM 进行自我校正的能力。</p>',11);function j(F,J){const i=n("ExternalLinkIcon"),t=n("center");return r(),o("div",null,[s("blockquote",null,[s("p",null,[e("论文："),s("a",h,[e("MAGIC: Generating Self-Correction Guideline for In-Context Text-to-SQL"),a(i)])]),g,d]),u,_,a(t,null,{default:l(()=>[k]),_:1}),x,f,b,L,a(t,null,{default:l(()=>[y]),_:1}),v,w,M,S,Q,z,I,C,T,G,N,A,q,B,E,D,P,V,R])}const W=c(p,[["render",j],["__file","index.html.vue"]]),X=JSON.parse(`{"path":"/arxiv/2406.12692/","title":"🌙 MAGIC：为 Text2SQL 任务自动生成 self-correction guideline","lang":"zh-CN","frontmatter":{"title":"🌙 MAGIC：为 Text2SQL 任务自动生成 self-correction guideline","author":"Bin Yu","createTime":"2024/06/25 16:05:00","permalink":"/arxiv/2406.12692/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if (um === 'dark' || (um !== 'light' && sm)) {document.documentElement.classList.add('dark');}})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"一、论文速读","slug":"一、论文速读","link":"#一、论文速读","children":[]},{"level":2,"title":"二、MAGIC","slug":"二、magic","link":"#二、magic","children":[{"level":3,"title":"2.1 Feedback-correction cycle","slug":"_2-1-feedback-correction-cycle","link":"#_2-1-feedback-correction-cycle","children":[]},{"level":3,"title":"2.2 Revising agents' instruction","slug":"_2-2-revising-agents-instruction","link":"#_2-2-revising-agents-instruction","children":[]},{"level":3,"title":"2.3 Guideline generation","slug":"_2-3-guideline-generation","link":"#_2-3-guideline-generation","children":[]}]},{"level":2,"title":"三、所有用到的 prompts","slug":"三、所有用到的-prompts","link":"#三、所有用到的-prompts","children":[]},{"level":2,"title":"四、实验","slug":"四、实验","link":"#四、实验","children":[]},{"level":2,"title":"五、总结","slug":"五、总结","link":"#五、总结","children":[]}],"readingTime":{"minutes":3.94,"words":1181},"git":{"updatedTime":1719411379000,"contributors":[{"name":"yubinCloud","email":"yubin_SkyWalker@yeah.net","commits":2}]},"filePathRelative":"notes/Text2SQL/2406.MAGIC.md","categoryList":[{"type":10000,"name":"notes"},{"type":10004,"name":"Text2SQL"}]}`);export{W as comp,X as data};
