import{_ as c,r as l,o,c as m,a as s,b as a,d as t,w as n,e as r}from"./app-s5JIphqh.js";const p={},h={href:"http://arxiv.org/abs/1809.05054",target:"_blank",rel:"noopener noreferrer"},u=s("p",null,"⭐⭐⭐",-1),d=s("p",null,"ICLR 2019，arXiv:1809.05054, Microsoft Research",-1),g=s("h2",{id:"一、论文速读",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#一、论文速读"},[s("span",null,"一、论文速读")])],-1),_=s("p",null,[a("本文提出了 "),s("mark",null,"IncSQL"),a("，一个使用 Non-Deterministic Oracles 思路的增量式 Text2SQL Parser，在 WikiSQL 上做的测试。")],-1),x=s("p",null,[a("该模型的输入 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"x")]),s("annotation",{encoding:"application/x-tex"},"x")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.4306em"}}),s("span",{class:"mord mathnormal"},"x")])])]),a(" 包括 NL question 和 table schema（不包含 content），输出 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"y")]),s("annotation",{encoding:"application/x-tex"},"y")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.625em","vertical-align":"-0.1944em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"y")])])]),a(" 是一个 SQL query。如下图所示：")],-1),y=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240527204509.png",alt:"20240527204509",style:{zoom:"75%"}},null,-1),v=s("p",null,"由于 WikiSQL 的 SQL 结构是固定的，所以每个 SQL query 唯一对应一个 structured representation，比如上面 example 的 SQL 对应下面这个结构：",-1),k=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240527204552.png",alt:"20240527204552",style:{zoom:"75%"}},null,-1),L=s("ul",null,[s("li",null,"这个 structure 包含 AGG、SELCOL 和 COND 三个部分。")],-1),w=s("h3",{id:"_1-1-将对-sql-的生成任务-视为对-action-sequence-的生成",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-1-将对-sql-的生成任务-视为对-action-sequence-的生成"},[s("span",null,"1.1 将对 SQL 的生成任务，视为对 action sequence 的生成")])],-1),b=s("p",null,[a("本文模型将 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"y")]),s("annotation",{encoding:"application/x-tex"},"y")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.625em","vertical-align":"-0.1944em"}}),s("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"y")])])]),a(" 的生成转变为这个 structure 的生成，这个 structure 的生成又转为对 action sequence 的生成：有一个初始 parser state "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"p"),s("mn",null,"0")])]),s("annotation",{encoding:"application/x-tex"},"p_0")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.625em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"p"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3011em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},"0")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a(" 和一个空的 struct，每一个 action 会在 struct 中填充一部分内容，并将 parser state 由 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"p")]),s("annotation",{encoding:"application/x-tex"},"p")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.625em","vertical-align":"-0.1944em"}}),s("span",{class:"mord mathnormal"},"p")])])]),a(" 进化为 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mi",null,"p"),s("mo",{mathvariant:"normal",lspace:"0em",rspace:"0em"},"′")])]),s("annotation",{encoding:"application/x-tex"},"p'")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.9463em","vertical-align":"-0.1944em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"p"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.7519em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"′")])])])])])])])])])])]),a("。所有可能的 action 如下表：")],-1),M=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240527205042.png",alt:"20240527205042",style:{zoom:"75%"}},null,-1),f=s("ul",null,[s("li",null,[s("code",null,"AGG(agg)"),a(" action 表示为 struct 的 AGG 部分填充上 agg 值")]),s("li",null,[s("code",null,"SELCOL(ci)"),a(" action 表示为 SELCOL 部分填充上 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"c"),s("mi",null,"i")])]),s("annotation",{encoding:"application/x-tex"},"c_i")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.5806em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"c"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3117em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"i")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a(" 值")]),s("li",null,[s("code",null,"CONDCOL(ci)"),a(" action 表示为 COND 部分增加一列，并且将这一列中的 COL 部分填充为 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"c"),s("mi",null,"i")])]),s("annotation",{encoding:"application/x-tex"},"c_i")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.5806em","vertical-align":"-0.15em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"c"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3117em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight"},"i")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])])])])]),a(" 值")]),s("li",null,[s("code",null,"CONDOP(op)"),a(" action 表示为 COND 中的 OP 部分填充 "),s("code",null,"op")]),s("li",null,[s("code",null,"CONDVAL(w i:j)"),a(" action 表示为 COND 中的 VAL 填充上 "),s("code",null,"question[i:j]"),a(" 的值")]),s("li",null,[s("code",null,"END"),a(" 表示 action sequence 的结束")])],-1),q=s("p",null,"由此，前面 Example 中的 SQL 的生成就可以被视为下面这个 action sequence：",-1),O=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240527205634.png",alt:"20240527205634",style:{zoom:"75%"}},null,-1),S=s("p",null,"这样，我们通过生成 action sequence，就可以生成一个 SQL query。",-1),C=s("h3",{id:"_1-2-decoder",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-2-decoder"},[s("span",null,"1.2 Decoder")])],-1),N=s("p",null,[a("假如我们已经通过 encoder 获得了 question 和 column headers 的上下文表示，使用 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mi",null,"a")]),s("annotation",{encoding:"application/x-tex"},"a")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.4306em"}}),s("span",{class:"mord mathnormal"},"a")])])]),a(" 表示一个 action。")],-1),z=s("p",null,[a("Decoder 模型就可以视为一个概率分布："),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msub",null,[s("mi",null,"P"),s("mi",null,"θ")]),s("mo",{stretchy:"false"},"("),s("mi",null,"a"),s("mi",{mathvariant:"normal"},"∣"),s("mi",null,"x"),s("mo",{separator:"true"},","),s("msub",null,[s("mi",null,"a"),s("mrow",null,[s("mo",null,"<"),s("mi",null,"i")])]),s("mo",{stretchy:"false"},")")]),s("annotation",{encoding:"application/x-tex"},"P_\\theta (a | x, a_{\\lt i})")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1em","vertical-align":"-0.25em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"P"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3361em"}},[s("span",{style:{top:"-2.55em","margin-left":"-0.1389em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.02778em"}},"θ")])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.15em"}},[s("span")])])])])]),s("span",{class:"mopen"},"("),s("span",{class:"mord mathnormal"},"a"),s("span",{class:"mord"},"∣"),s("span",{class:"mord mathnormal"},"x"),s("span",{class:"mpunct"},","),s("span",{class:"mspace",style:{"margin-right":"0.1667em"}}),s("span",{class:"mord"},[s("span",{class:"mord mathnormal"},"a"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.3117em"}},[s("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mrel mtight"},"<"),s("span",{class:"mord mathnormal mtight"},"i")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.1774em"}},[s("span")])])])])]),s("span",{class:"mclose"},")")])])]),a(" —— 表示根据 input x 和过去的 actions 来生成当前 step 的 action。")],-1),Q=s("p",null,"在一个 step 中，具体选择哪一个 action 作为下一个生成结果，是一个分类问题，模型为所有候选 actions 打分，并通过 softmax 概率化，按照贪心策略选择当前 step 最有可能的 action。",-1),D=s("p",null,"模型的具体选择上，使用了 LSTM 来一个 step 一个 step 的生成，每一个 step 基于 LSTM 当前的 hidden state 和 question 与 schema 的 representation 来做预测。具体做法可以参考原论文。",-1),E=s("h3",{id:"_1-3-encoder",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-3-encoder"},[s("span",null,"1.3 Encoder")])],-1),T=s("p",null,"Encoder 主要是为 question 和 column headers 生成 context-sensitive representation，本论文主要使用了 bi-LSTM，具体细节不再介绍。",-1),P=s("h3",{id:"_1-4-整体模型架构",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-4-整体模型架构"},[s("span",null,"1.4 整体模型架构")])],-1),I=s("p",null,"有了 Encoder 和 Decoder，本论文的模型架构如下图所示：",-1),A=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240527212046.png",alt:"20240527212046",style:{zoom:"75%"}},null,-1),j=r('<h2 id="二、non-deterministic-oracles" tabindex="-1"><a class="header-anchor" href="#二、non-deterministic-oracles"><span>二、Non-Deterministic Oracles</span></a></h2><p>由于同一个 question，可以对应多个等价的 SQL，因为 WHERE 子句中不同的 cond 是可以互换的。</p><p>以往的研究中，由于 order-matters 问题，都假设了每个 question 仅有一个正确的 SQL query，但这在实践中并不符合实际。</p><p>在本文模型的训练过程中，在让 model 生成下一个 step 的 action 时，允许他探索多种目标策略，而不仅仅单一的目标策略，这种方法被称为 <strong>Non-Deterministic Oracles</strong>。</p><p>比如在最开始的例子中，是先生成的 <code>CONDCOL(c3)</code> 再 <code>CONDCOL(c2)</code>，但训练时也允许先 <code>CONDCOL(c2)</code>。</p><p>同时 Non-Deterministic Oracle 还增加了一个特殊列名 ANYCOL，因为所要预测的 column name 有可能不出现在 question 中，比如 &quot;What is the area of Canada?&quot; 中并没有 country 这个单词，为了预测这个单词，模型可以输出 <code>CONDCOL(ANYCOL)</code>，在后面，我们会将其做扩展，比如模型如果想表达 <code>ANYCOL=&#39;Willis&#39;</code>，那我们会扩展为 <code>rank=&#39;Willis&#39; OR name=&#39;Willis&#39; OR ...</code>，这样当 value 可以明确地解析为一个 column name 时，这样的 ANYCOL 时被视为正确的操作。</p><p>模型的损失函数被定义如下：</p>',7),W=s("img",{src:"https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240527213325.png",alt:"20240527213325",style:{zoom:"75%"}},null,-1);function G(R,V){const i=l("ExternalLinkIcon"),e=l("center");return o(),m("div",null,[s("blockquote",null,[s("p",null,[a("论文："),s("a",h,[a("IncSQL: Training Incremental Text-to-SQL Parsers with Non-Deterministic Oracles"),t(i)])]),u,d]),g,_,x,t(e,null,{default:n(()=>[y]),_:1}),v,t(e,null,{default:n(()=>[k]),_:1}),L,w,b,t(e,null,{default:n(()=>[M]),_:1}),f,s("blockquote",null,[q,t(e,null,{default:n(()=>[O]),_:1})]),S,C,N,z,Q,D,E,T,P,I,t(e,null,{default:n(()=>[A]),_:1}),j,t(e,null,{default:n(()=>[W]),_:1})])}const B=c(p,[["render",G],["__file","index.html.vue"]]),H=JSON.parse(`{"path":"/arxiv/1809.05054/","title":"💦 IncSQL：通过增量式生成 action 序列来得到 SQL","lang":"zh-CN","frontmatter":{"title":"💦 IncSQL：通过增量式生成 action 序列来得到 SQL","author":"Bin Yu","createTime":"2024/05/27 20:31:00","permalink":"/arxiv/1809.05054/","head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if (um === 'dark' || (um !== 'light' && sm)) {document.documentElement.classList.add('dark');}})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":2,"title":"一、论文速读","slug":"一、论文速读","link":"#一、论文速读","children":[{"level":3,"title":"1.1 将对 SQL 的生成任务，视为对 action sequence 的生成","slug":"_1-1-将对-sql-的生成任务-视为对-action-sequence-的生成","link":"#_1-1-将对-sql-的生成任务-视为对-action-sequence-的生成","children":[]},{"level":3,"title":"1.2 Decoder","slug":"_1-2-decoder","link":"#_1-2-decoder","children":[]},{"level":3,"title":"1.3 Encoder","slug":"_1-3-encoder","link":"#_1-3-encoder","children":[]},{"level":3,"title":"1.4 整体模型架构","slug":"_1-4-整体模型架构","link":"#_1-4-整体模型架构","children":[]}]},{"level":2,"title":"二、Non-Deterministic Oracles","slug":"二、non-deterministic-oracles","link":"#二、non-deterministic-oracles","children":[]}],"readingTime":{"minutes":3.49,"words":1047},"git":{"updatedTime":1717830098000,"contributors":[{"name":"yubinCloud","email":"yubin_SkyWalker@yeah.net","commits":2}]},"filePathRelative":"notes/Text2SQL/1809.IncSQL.md","categoryList":[{"type":10000,"name":"notes"},{"type":10004,"name":"Text2SQL"}]}`);export{B as comp,H as data};
