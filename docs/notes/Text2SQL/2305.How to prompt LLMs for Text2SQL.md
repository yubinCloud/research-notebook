---
title: ğŸŒ™ How to prompt LLMs for Text2SQL
author: Bin Yu
createTime: 2024/06/06 16:43:00
permalink: /arxiv/2305.11853/
---

> è®ºæ–‡ï¼š[How to Prompt LLMs for Text-to-SQL: A Study in Zero-shot, Single-domain, and Cross-domain Settings](http://arxiv.org/abs/2305.11853)
>
> â­â­â­â­
>
> arXiv:2305.11853, NeurlPS 2023
>
> Code: [GitHub](https://github.com/shuaichenchang/prompt-text-to-sql)

## ä¸€ã€è®ºæ–‡é€Ÿè¯»

æœ¬æ–‡ä¸»è¦æ˜¯åœ¨ä¸‰ç§å¸¸è§çš„ Text2SQL ICL settings è¯„ä¼°ä¸åŒçš„ prompt construction strategiesã€‚

## äºŒã€Text2SQL ICL settings

è®ºæ–‡åœ¨ä¸‹é¢ä¸‰ç§ Text2SQL settings ä¸‹æ¥åšçš„è¯„ä¼°ï¼š

- **Zero-shot Text2SQL**ï¼šè¾“å…¥ä¸€ä¸ª task instructionã€ä¸€ä¸ª test question ä»¥åŠç›¸åº”çš„ DBï¼Œåœ¨æ²¡æœ‰ä»»ä½• demonstrations æƒ…å†µä¸‹è®© LLM ç›´æ¥æ¨ç†å‡º SQL
- **Single-domain Few-shot Text2SQL**ï¼šICL çš„ demonstrations æ˜¯æ„é€ è‡ªä¸ test question ç›¸åŒçš„ databaseã€‚è¿™ä¸ª setting çš„ç›®æ ‡æ˜¯è¯„ä¼° LLM åœ¨æœ€å°çš„åŸŸå†…è®­ç»ƒæ•°æ®ä¸‹æ‰§è¡Œ Text2SQL çš„èƒ½åŠ›ã€‚
- **Cross-domain Few-shot Text2SQL**ï¼šICL çš„ demonstrations æ˜¯æ„é€ è‡ªä¸ test question çš„ä¸åŒçš„ database ä¸­ã€‚è¿™ä¸ª setting çš„ç›®æ ‡æ˜¯è¯„ä¼° LLM é€šè¿‡ out-of-domain demonstrations ä¸­æ¥å­¦ä¹ çš„æ³›åŒ–èƒ½åŠ›ã€‚

## ä¸‰ã€Prompt Construction

è®ºæ–‡åœ¨æ¯ä¸ª Text2SQL setting ä¸­æµ‹è¯•äº†ä¸åŒçš„ prompt construction çš„æ•ˆæœã€‚

ä¸€ä¸ª prompt ä¸­åŒ…å« Database Prompt å’Œ Demonstration Promptã€‚

### 3.1 Database Prompt

ä¸€ä¸ªå…³ç³»å‹ DB åŒ…å« database schema å’Œ database contentï¼š

- database schema ç”± table headers å’Œ tables ä¹‹é—´çš„ relationships ç»„æˆã€‚
- database content æŒ‡çš„æ˜¯å­˜å‚¨åœ¨ tables ä¸­çš„ data

#### 3.1.1 Database Schema çš„ prompt ç»“æ„

ä¸‹å›¾å±•ç¤ºäº†ä¹‹å‰çš„ç ”ç©¶ä¸­ä½¿ç”¨çš„ database schema çš„å„ç§ prompt ç»“æ„ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240606200416.png" alt="20240606200416" style="zoom:75%;"></center>

åŒæ—¶ä¸ºäº†ä¿è¯æ–‡æœ¬çš„ä¸€è‡´æ€§ï¼Œè®ºæ–‡å¯¹ db schema å’Œ SQL åšäº†è§„èŒƒåŒ–ï¼šå°† SQL ä¸­é™¤äº†æ•°æ®åº“å†…å®¹ä¹‹å¤–çš„æ‰€æœ‰å•è¯è½¬æ¢ä¸ºå°å†™ï¼Œå¹¶ç»Ÿä¸€æ–‡æœ¬ä¸­çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ã€‚å¦‚ä¸‹å›¾å°±æ˜¯è§„èŒƒåŒ–å‰åçš„ç¤ºä¾‹ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240606201528.png" alt="20240606201528" style="zoom:75%;"></center>

#### 3.1.2 Database Content çš„ prompt ç»“æ„

ä¹‹å‰çš„ç ”ç©¶å†…å®¹ä¹Ÿè¡¨ç¤ºï¼Œäº†è§£æ•°æ®åº“çš„å†…å®¹ç¤ºä¾‹å¯ä»¥æé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚

ä¸‹å›¾å±•ç¤ºäº† Database Content éƒ¨åˆ†çš„ prompt styleï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240606200843.png" alt="20240606200843" style="zoom:75%;"></center>

- *InsertRow*ï¼šé€šè¿‡ `INSERT INTO` è¯­å¥æ˜¾ç¤ºæ¯ä¸ª table çš„å‡ è¡Œæ•°æ®
- *SelectRow*ï¼šæ˜¾ç¤º `SELECT * FROM T LIMIT X` çš„æŸ¥è¯¢ç»“æœ
- *SelectCol*ï¼šæŒ‰ç…§åˆ—å¼çš„æ ¼å¼æ˜¾ç¤ºå¤šè¡Œæ•°æ®

æœ¬æ–‡æå‡ºä½¿ç”¨ `SELECT DISTINCT [Column] FROM [Table] LIMIT R` å»åˆ—å‡º R è¡Œæ•°æ®ï¼Œä»è€Œé¿å…é‡å¤ã€‚

### 3.2 Demonstration Prompt

åœ¨ few-shots settings ä¸­ï¼Œdemonstrations è¢«æ”¾å…¥ prompt text æ¥è¾“å…¥ç»™ LLMã€‚

åœ¨ single-domain few-shot setting ä¸­ï¼Œè¿™é‡Œèå…¥äº†ä¸€äº› question-SQL çš„ pairs ä½œä¸º demonstrationsã€‚

åœ¨ cross-domain few-shot setting ä¸­ï¼Œä»¥å¾€çš„ç ”ç©¶éƒ½æ˜¯ï¼š

- è¦ä¹ˆ N ä¸ª examples éƒ½æ¥è‡ªäºä¸€ä¸ªç›¸åŒçš„ db
- è¦ä¹ˆ N ä¸ª examples çš„æ¯ä¸€ä¸ªæ¥è‡ªäºä¸åŒçš„ db

æœ¬æ–‡è€ƒè™‘äº†æ›´æ³›ç”¨çš„åœºæ™¯ï¼šN ä¸ª examples æ˜¯ç”± M ä¸ª db ç»„æˆï¼Œæ¯ä¸ª db ç”± K ä¸ª question-SQL pairsï¼Œç”±æ­¤ $M \times K = N$ã€‚

## å››ã€å®éªŒ

æœ¬æ–‡åœ¨ Spider æ•°æ®é›†çš„ dev split ä¸Šå®éªŒï¼Œé‡‡ç”¨æ‰§è¡Œç²¾åº¦ï¼ˆEXï¼‰æ¥è¯„ä¼° predicted SQL å’Œ gold SQLã€‚

è¿™é‡Œè®ºæ–‡æŒ‡å‡ºï¼Œåœ¨é€‰æ‹© few-shots çš„ demonstrations æ—¶ï¼Œç”±äºå°‘æ•° db åŒ…å«é•¿æ¨¡å¼ï¼Œè¿™æœ‰å¯èƒ½å¯¼è‡´ prompt token æ•°é‡è¶…è¿‡ LLM é™åˆ¶ï¼Œæ‰€ä»¥åœ¨æ„é€  CreateTable prompt æ—¶ï¼Œè¿™é‡Œåªä½¿ç”¨ token å°‘äº 1000 çš„ dbã€‚

å…·ä½“çš„å®éªŒç»†èŠ‚å¯ä»¥å‚è€ƒåŸè®ºæ–‡ã€‚

## äº”ã€å®éªŒç»“æœ

è¿™ä¸€ç« ä»‹ç»äº†åœ¨ zero-shotã€single-domain å’Œ cross-domain çš„ä¸‰ç§ settings ä¸‹ Text2SQL çš„ç»éªŒå‘ç°ã€‚

### 5.1 zero-shot çš„ Text2SQL

zero-shot setting ä¸­é‡ç‚¹å…³æ³¨äºæ¯”è¾ƒä¸åŒçš„ database prompt constructionã€‚ä¸‹å›¾å±•ç¤ºäº†å¤šç§ database prompt çš„ Codex å’Œ ChatGPT çš„è¡¨ç°ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240606203521.png" alt="20240606203521" style="zoom:75%;"></center>

å®éªŒå‘ç°ï¼š

- è§„èŒƒåŒ–åçš„ db schema å’Œ SQL å¯ä»¥æœ‰æ›´å¥½çš„è¡¨ç°
- db table çš„ relationship å’Œ content æ˜¯å¾ˆé‡è¦çš„ï¼Œæœ‰æ•ˆåœ°æé«˜äº† LLM çš„è¡¨ç°
- Codex åœ¨ zero-shot Text2SQL ä»»åŠ¡ä¸Šå§‹ç»ˆä¼˜äº ChatGPT

åŸºäºä»¥ä¸Šå‘ç°ï¼Œè®ºæ–‡å»ºè®®å°† Codex ä¸è§„èŒƒåŒ–åçš„ CreateTable-SelectCol prompt construction ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œæ¥å®ç° zero-shot çš„ Text2SQLã€‚

### 5.2 single-domain çš„ Text2SQL

ä¸‹å›¾å±•ç¤ºäº†åœ¨ Codex å’Œ ChatGPT ä¸Šåš single-domain Text2SQL ä»»åŠ¡æ—¶ï¼Œä¸åŒçš„ in-domain examples çš„æ‰§è¡Œç²¾ç¡®åº¦çš„å®éªŒç»“æœï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240606204228.png" alt="20240606204228" style="zoom:75%;"></center>

å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

- in-domain çš„ demonstrations èƒ½æœ‰æ•ˆæå‡ LLM çš„è¡¨ç°ï¼Œå¹¶éšç€ç¤ºä¾‹æ•°é‡çš„æé«˜ï¼ŒLLM çš„æ•ˆæœä¹Ÿåœ¨é€æ¸å˜å¥½
- LLM èƒ½å¤Ÿä» in-domain demonstrations ä¸­å¿«é€Ÿå­¦ä¹ åˆ° table relationshipï¼Œä½†éš¾ä»¥ä»ä¸­å­¦ä¹ åˆ° table content çš„çŸ¥è¯†ï¼Œå› æ­¤ table content çš„ prompt æ˜¯é‡è¦çš„

### 5.3 cross-domain çš„ Text2SQL

ICL çš„ demonstrations ä¸­ä½¿ç”¨äº† M çš„ demonstration databasesï¼Œæ¯ä¸€ä¸ªåŒ…å« K ä¸ª NLQ-SQL pairsã€‚

ä¸‹é¢è¿™ä¸ªçƒ­åŠ›å›¾å±•ç¤ºäº† M å’Œ K çš„ä¸ªæ•°å¯¹ç²¾ç¡®åº¦çš„å½±å“ï¼ˆæ¨ªè½´æ˜¯ Mï¼Œçºµè½´æ˜¯ Kï¼Œé¢œè‰²è¶Šæ·±ï¼Œç²¾ç¡®åº¦è¶Šé«˜ï¼‰ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240606205110.png" alt="20240606205110" style="zoom:75%;"></center>

è¿™é‡Œå¯¹å®éªŒçš„åˆ†æå¯ä»¥å‚è€ƒåŸè®ºæ–‡ã€‚

**æ€»ä¹‹ï¼Œout-of-domain çš„ demonstrations å¢å¼ºäº† LLM åœ¨ Text2SQL ä¸­çš„èƒ½åŠ›ï¼Œä½†è¿™äº›ç¤ºä¾‹å¹¶æ²¡æœ‰æä¾›ç‰¹å®šäº DB çš„çŸ¥è¯†ï¼Œå› æ­¤ï¼Œä»”ç»†æ„å»º Database Prompt ä»ç„¶è‡³å…³é‡è¦**ï¼Œè¿™ä¹Ÿä¸åœ¨ zero-shot setting ä¸­æ‰€åšçš„è§‚å¯Ÿæ˜¯ä¸€è‡´çš„ã€‚

## å…­ã€æ€»ç»“

æ•´çš„æ¥è¯´ï¼Œè®ºæ–‡åœ¨ä¸‰ç§ Text2SQL ICL settings ä¸­æ¯”è¾ƒäº†å„ç§ prompt constructions çš„æ•ˆæœï¼Œä¸ºæœªæ¥çš„ç ”ç©¶æä¾›äº†æŒ‡å¯¼ã€‚
