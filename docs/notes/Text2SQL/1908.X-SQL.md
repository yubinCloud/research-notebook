---
title: ğŸ‹ ç»å…¸è®ºæ–‡ï¼šX-SQL
author: Bin Yu
createTime: 2024/05/24 16:44:00
permalink: /arxiv/1908.08113/
---

> è®ºæ–‡ï¼š[X-SQL: reinforce schema representation with context](http://arxiv.org/abs/1908.08113)
>
> â­â­â­â­
>
> Microsoft, arXiv:1908.08113

X-SQL ä¸ SQLova ç±»ä¼¼ï¼Œä½¿ç”¨ BERT style çš„ PLM æ¥è·å¾— representationï¼Œåªæ˜¯èåˆ NL question å’Œ table schema çš„ä¿¡æ¯çš„æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯åœ¨åˆ©ç”¨ BERT-style å¾—åˆ°çš„ representation åè¿›ä¸€æ­¥çš„åŠ å·¥æ–¹å¼ä¸ä¸€æ ·ã€‚

**X-SQL å…ˆç”± BERT-style PLM ç”Ÿæˆ question å’Œ schema çš„ representationï¼Œç„¶åå¯¹ schema representation åšä¸Šä¸‹æ–‡ä¿¡æ¯çš„è¿›ä¸€æ­¥åŠ å¼ºï¼Œå†äº¤ç”± 6 ä¸ª sub-task åˆ†åˆ«æ„å»ºå‡º SQL çš„ä¸€éƒ¨åˆ†ï¼Œæœ€ç»ˆå¾—åˆ°å®Œæ•´çš„ SQL**ã€‚

## ä¸€ã€X-SQL

æ•´ä¸ªæ¶æ„åŒ…å«ä¸‰å±‚ï¼šsequence encoderã€context enhancing schema encoder å’Œ output layerã€‚

### 1.1 Sequence Encoderï¼šå¾—åˆ° PLM çš„ representation

å°† question å’Œ table headers æ‹¼è£…æˆä¸‹é¢çš„å½¢å¼ï¼ˆä¸ SQLova çš„ç±»ä¼¼ï¼‰ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524204838.png" alt="20240524204838" style="zoom:75%;"></center>

- æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç©º column è¢«é™„åŠ åˆ°æ¯ä¸ª table schema æœ€åï¼Œä¹Ÿå°±æ˜¯å®é™…æœ€åä¸€ä¸ª column åé¢ä¼šåœ¨åŠ ä¸€ä¸ª `[EMPTY]`
- å°† `[CLS]` é‡å‘½åä¸º `[CTX]`ï¼Œç”¨æ¥å¼ºè°ƒè¿™é‡Œæ˜¯æ•è·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€Œéç”¨äºä¸‹æ¸¸ä»»åŠ¡çš„ representation
- SQLova ä¸­çš„ segment embeddings è¢«æ›¿æ¢ä¸º type embeddingsï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸ºå››ç§ types å­¦ä¹ çš„ embeddingsï¼šquestionã€categorial columnã€numerical column å’Œ special empty column

å¦å¤–ï¼Œè¿™é‡Œçš„ PLM ä¸æ˜¯ä½¿ç”¨ BERT-Large åˆå§‹åŒ–çš„ï¼Œè€Œæ˜¯ä½¿ç”¨ MT-DNN åˆå§‹åŒ–çš„ï¼Œå®ƒä¸ BERT æ¶æ„ç›¸åŒï¼Œåªæ˜¯åœ¨å¤šä¸ª GLUE ä»»åŠ¡ä¸Šåšè¿‡è®­ç»ƒï¼Œä»è€Œèƒ½å¤Ÿå¾—åˆ°æ›´å¥½çš„ç”¨äºä¸‹æ¸¸ä»»åŠ¡çš„ representationã€‚

ç»è¿‡è¿™ä¸€å±‚ï¼Œæˆ‘ä»¬ä¸º question å’Œ table schema çš„æ¯ä¸ª token éƒ½åˆ©ç”¨ BERT-style PLM ç”Ÿæˆä¸€ä¸ª hidden stateã€‚

### 1.2 Context Enhanced Schema Encoderï¼šåŠ å¼º schema representation

åœ¨ä¸Šä¸€å±‚ seq encoder ä¸­ï¼Œæˆ‘ä»¬ä¸º question å’Œ table headers çš„æ¯ä¸ª token éƒ½å¾—åˆ°ä¸€ä¸ª hidden state vectorï¼Œåœ¨è¿™ä¸€å±‚ï¼Œæˆ‘ä»¬çš„ context enchanced schema encoder é€šè¿‡ç”¨ $h_{[CTX]}$ æ¥åŠ å¼ºå‰é¢ encoder çš„è¾“å‡ºï¼Œä»è€Œå¾—åˆ°æ¯ä¸ª column çš„ä¸€ä¸ªæ–°çš„ representation $h_{C_i}$ï¼Œå®ƒä»£è¡¨ column *i* çš„æ–° representationã€‚

è®ºæ–‡è®¤ä¸ºï¼Œå°½ç®¡ BERT style çš„ sequence encoder åœ¨å®ƒçš„ output ä¸­ä¹Ÿæ•æ‰åˆ°äº†ä¸€å®šçš„ contextï¼Œä½†æ˜¯è¿™ç§ context influence å—é™äº self-attention çš„æœºåˆ¶ï¼ˆå®ƒå€¾å‘äºå…³æ³¨æŸä¸ªç‰¹å®š region ä»è€Œç¼ºå°‘å…¨å±€ä¿¡æ¯ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨å¸¦æœ‰å…¨å±€ä¿¡æ¯çš„ `[CTX]` çš„ hidden state æ¥åŠ å¼º representationã€‚

è¿™é‡Œçš„å…·ä½“åšæ³•å°±æ˜¯ï¼Œå°† column *i* çš„æ‰€æœ‰ token çš„ hidden state å’Œ $h_{[CTX]}$ ä¸€èµ·è¾“å…¥åˆ°ä¸€ä¸ª Attention å±‚ä¸­ï¼Œå¾—åˆ°åŠ å¼ºåçš„æ–°çš„ column $i$ çš„ representationï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524210700.png" alt="20240524210700" style="zoom:75%;"></center>

**ç»è¿‡è¿™ä¸€å±‚ encoderï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸Šä¸‹æ–‡å¢å¼ºçš„ schema representationï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª column çš„æ–° representation**ã€‚

è¿™ä¸€æ­¥çš„åšæ³•ä¹Ÿä½“ç°å‡º X-SQL ä¸ SQLova çš„åŒºåˆ«ï¼Œè¿™ä¸€å±‚çš„ "context enchanced schema encoder" å’Œ SQLova ä¸­å¼•å…¥çš„ column-attention æœºåˆ¶éƒ½æ˜¯ä¸ºäº†ç›¸åŒçš„ç›®æ ‡ï¼šæ›´å¥½åœ°å¯¹é½ question å’Œ table schemaï¼Œä½†ä¸¤è€…çš„å®ç°æ€è·¯å´ä¸åŒï¼š

- column-attention é€šè¿‡å°† column ä½œä¸ºæ¡ä»¶æ¥æ”¹å˜ question çš„ç¼–ç 
- context enchanced schema encoder è®¤ä¸º BERT-style çš„ encoder å·²ç»è¶³å¤Ÿå¥½äº†ï¼Œåªæ˜¯åŸºäºæ­¤å¹¶è¯•å›¾ä½¿ç”¨ `[CTX]` ä¸­æ•è·çš„å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥å¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„ representationã€‚

### 1.3 Output Layerï¼šå®Œæˆå„ sub-task ç”Ÿæˆ SQL

è¿™ä¸€å±‚å€ŸåŠ© sequence encoder è¾“å‡ºçš„ hidden states å’Œ context enchanced schema encoder è¾“å‡ºçš„ $h_{C_1}$ã€$h_{C_2}$ã€...ã€$h_{[EMPTY]}$ æ¥ç”Ÿæˆ SQLã€‚è¿™é‡Œçš„æ€è·¯ä¹Ÿæ˜¯åŸºäº SQL sketch å¹¶å¡«å…… slotsã€‚

è¿™ä¸€æ­¥çš„ä»»åŠ¡è¢«åˆ†è§£æˆäº† 6 ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡é¢„æµ‹æœ€ç»ˆ SQL ç¨‹åºçš„ä¸€éƒ¨åˆ†ã€‚

#### 1.3.1 ç”¨æ¥ä¿®æ­£ schema representation çš„ sub-network

é¦–å…ˆï¼Œè¿™é‡Œå¼•å…¥äº†ä¸€ä¸ª sub-network ç”¨æ¥è°ƒæ•´ schema representation with contextï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åˆ†åˆ«å¯¹ $H_{[CTX]}$ å’Œ $H_{C_i}$ åšä¸€ä¸ªä»¿å°„å˜æ¢ï¼Œå†åŠ èµ·æ¥ç»è¿‡ä¸€ä¸ª LayerNorm å¾—åˆ° $r_{C_i}$ï¼ˆcolumn *i* ä¸€ä¸ªä¿®æ­£åçš„ representationï¼‰ï¼Œå›¾ç¤ºå¦‚ä¸‹ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524213837.png" alt="20240524213837" style="zoom:75%;"></center>

å…¬å¼å¦‚ä¸‹ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524213850.png" alt="20240524213850" style="zoom:75%;"></center>

æ³¨æ„ï¼Œè¿™ä¸ª sub-network åœ¨æ¯ä¸ª sub-task ä¸­éƒ½æ˜¯ç‹¬ç«‹è®­ç»ƒçš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª sub-task å¾—åˆ°çš„ $r_{C_i}$ æ˜¯ä¸åŒçš„ï¼Œ**è¿™ä¹Ÿä½“ç°äº†è¿™ä¸ª sub-network å°±æ˜¯é’ˆå¯¹ä¸€ä¸ªå…·ä½“ task æ¥ä¿®æ­£ schema representation**ã€‚

ä¹‹åï¼Œå„ä¸ª sub-task å°±å¯ä»¥åŸºäºæˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„ vectors å’Œ $r_{C_i}$ æ¥åšäº†ã€‚

#### 1.3.2 sub-task 1ï¼šS-COL

S-COL ä»»åŠ¡æ˜¯é¢„æµ‹ SELECT è¯­å¥ä¸­çš„ columnsï¼Œè¿™å…¶å®å°±æ˜¯è®¡ç®—å„ä¸ª columns çš„ä¸€ä¸ªæ¦‚ç‡ï¼Œè®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524214322.png" alt="20240524214322" style="zoom:75%;"></center>

å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåªä½¿ç”¨äº† $r_{C_i}$ï¼Œå¦å¤–çš„ $W$ æ˜¯ä¸€ä¸ªå¯è®­ç»ƒå‚æ•°ã€‚

#### 1.3.3 sub-task 2ï¼šS-AGG

ç›´è§‰æ¥è¯´ï¼Œaggregator çš„é€‰æ‹©ä¼šä¾èµ–æ‰€é€‰ä¸­çš„ column çš„ç±»å‹ï¼Œæ¯”å¦‚ aggregator `MIN` åªèƒ½è¢«ç”¨äºæ•°å­—ç±»å‹çš„ columnã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›´è§‰ï¼Œè¿™ä¸ª task åœ¨åš aggregator åˆ†ç±»æ—¶ï¼Œä¼šåˆ©ç”¨åˆ° column type çš„ embeddingï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524214556.png" alt="20240524214556" style="zoom:75%;"></center>

å…·ä½“å…¬å¼å¯ä»¥å‚è€ƒåŸè®ºæ–‡

#### 1.3.4 å…¶ä»– sub-task

å…¶ä»– sub-task å…±åŒç¡®å®šå‡º WHERE éƒ¨åˆ†ï¼Œè¿™é‡Œå¯ä»¥å…·ä½“å‚è€ƒåŸè®ºæ–‡ï¼Œæ•´ä½“æ€è·¯æ˜¯å·®ä¸å¤šçš„ã€‚

## äºŒã€æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ”¹è¿›ï¼ŒX-SQL åœ¨è¡¨ç° WikiSQL ä¸Šçš„è¡¨ç°æå‡åˆ° 90% ä»¥ä¸Šï¼Œè¶…è¿‡äº† SQLovaï¼š

<center><img src="https://notebook-img-1304596351.cos.ap-beijing.myqcloud.com/img/20240524215025.png" alt="20240524215025" style="zoom:75%;"></center>

æœ¬æ–‡å¯¹ BERT-style ç”Ÿæˆçš„ representation çš„è¿›ä¸€æ­¥çš„åŠ å·¥åˆ©ç”¨å€¼å¾—ç ”ç©¶å­¦ä¹ ã€‚